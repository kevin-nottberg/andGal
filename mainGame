package com.android.andGal.mainGame;

import java.io.IOException;
import java.io.InputStream;

import android.app.Activity;
import android.content.Context;
import android.content.res.AssetManager;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.graphics.Paint.Style;
import android.os.Bundle;
import android.support.v4.view.MotionEventCompat;
import android.util.Log;
import android.view.MotionEvent;
import android.view.SurfaceHolder;
import android.view.SurfaceView;
import android.view.View;
import android.view.View.OnTouchListener;
import android.view.Window;
import android.view.WindowManager;

public class AndroidGal extends Activity implements OnTouchListener
{
    AssetManager fdman;
    Bitmap bitMap1;
    Bitmap bitMap2;
    BitMapHandler bitmapHndler1;
    BitMapHandler bitmapHndler2;
    RenderView renView;
    
    String img1;
    String img2;
    
    SpaceShip tSpaceShip;
    SpaceShip bSpaceShip;
    
    int BLUE = 1;
    int YELLOW = 2;
    int RED = 3;
    int GREEN = 4;
    
    public void onCreate( Bundle savedInstanceState )
    {
        super.onCreate( savedInstanceState );
        
        tSpaceShip = new SpaceShip( RED );
        bSpaceShip = new SpaceShip( YELLOW );
        
        img1 = tSpaceShip.getImgAddress();
        img2 = tSpaceShip.getImgAddress();
        
        bitmapHndler1 = new BitMapHandler( this, fdman, bitMap1 );
        bitmapHndler2 = new BitMapHandler( this, fdman, bitMap2 );
        
        bitmapHndler1.createBitMap( img1 );
        bitmapHndler2.createBitMap( img2 );
        
        requestWindowFeature( Window.FEATURE_NO_TITLE );
    	getWindow().setFlags( WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN );
        
        renView = new RenderView( this );
        renView.setOnTouchListener( this );
        setContentView( renView );
        
    }
    
    public boolean onTouch( View v, MotionEvent event )
    {
		// Initilizing some varibles for multi-touch
		int halfHeight = renView.getHeight() / 2;
		int maxCount = event.getPointerCount();
		int action = MotionEventCompat.getActionMasked( event );
		Log.d("KevinApp", "OnTouch: " + String.valueOf( action ));
		for ( int i = 0; i < maxCount; i++ )
		{
			// int mActivePointerId = event.getPointerId( i );
			// int pointerIndex = event.findPointerIndex( mActivePointerId );
			// int index = MotionEventCompat.getActionIndex( event );
   
			// Reacting to the finger taps
			switch( action )
			{
				case MotionEvent.ACTION_DOWN:
				case MotionEvent.ACTION_POINTER_DOWN:
				case MotionEvent.ACTION_MOVE:
					if ( MotionEventCompat.getY( event, i ) < halfHeight )
					{
						//curPointPosXtwo = (int) MotionEventCompat.getX( event, i );
						// curPointPosYtwo = (int) MotionEventCompat.getY( event, i );
					}
					if ( MotionEventCompat.getY( event, i ) > halfHeight )
					{
						//curPointPosXone = (int) MotionEventCompat.getX( event, i );
						// curPointPosYone = (int) MotionEventCompat.getY( event, i );
					}
			break;
			}
		}	
		return true;
	}
    
    public void onResume()
    {
        super.onResume();
        renView.resume();
    }
    
    public void onPause()
    {
        super.onPause();
        renView.pause();
    }
    
    public class RenderView extends SurfaceView implements Runnable
    {
        Thread renThread;
        SurfaceHolder holder;
        volatile boolean running = false;
        Paint paint;
        
        public RenderView( Context context )
        {   
            super( context );
            holder = getHolder();
            paint = new Paint();
        }
        
        public void resume()
        {
        	renThread = new Thread( this );
        	running = true;
        	renThread.start();
        }
        
        public void pause() 
		{
			Log.d("KevinMess", "renderPause");
			running = false;
			while( true )
			{
				try {
					renThread.join();
					return;
				} catch ( InterruptedException e ) {
					//retry
				}
			}
		}
        
        public void run()
        {
        	long startTime = System.nanoTime();
        	
        	while( running )
        	{
        		float deltaTime = ( System.nanoTime() - startTime ) * 1000000000.0f;
        		
        		if ( !holder.getSurface().isValid() )
        			continue;
        			
        		Canvas canvas = holder.lockCanvas();
        		canvas.drawRGB( 0, 0, 0 );
        		paint.setStyle( Style.FILL );
        		int width = canvas.getWidth();
        		int height = canvas.getHeight();
        	
        		holder.unlockCanvasAndPost( canvas );
        	}
        }
    }
    
    public class SpaceShip
    {
 		private int clipStat;
 		private int Color; 
		private int reloadLoop;
		private int bulletRX;
		private int bulletTY;
		private int bulletLX;
		private int bulletBY;
 	
    	public SpaceShip( int clr )
    	{
    		clipStat = 6;
    		reloadLoop = 0;
    		Color = clr;
    	}
    	
    	public void shoot()
    	{
    		if ( clipStat == 6 )
    		{
    			clipStat = 5;
    		}
    		
    		if ( clipStat == 5 )
    		{
    			clipStat = 4;
    		}
    		
    		if ( clipStat == 4 )
    		{
    			clipStat = 3;
    		}
    		
    		if ( clipStat == 3 )
    		{
    			clipStat = 2;
    		}
    		
    		if ( clipStat == 2 )
    		{
    			clipStat = 1;
    		}
    		
    		if ( clipStat == 1 )
    		{
    			clipStat = 0;
    		}
    		
    		if ( clipStat == 0 )
    		{
    			reloadLoop++;
    		}
    		
  			if ( clipStat == 0 && reloadLoop == 1 )
  			{
  				reloadLoop = 0;
  				clipStat = 6;
  			}
    	}
    	
    	public String getImgAddress()
    	{
    		if ( Color == BLUE )
    		{
				return "andgal_space_blu.png";
    		}
    		
    		if ( Color == YELLOW )
    		{
				return "andgal_space_ylw.png";
    		}
    		
    		if ( Color == RED )
    		{
    			return "andgal_space_red.png";
    		}
    		
    		if ( Color == GREEN )
    		{
    			return "andgal_spacee_grn.png";
    		}
    		else 
    		{
    			return null;
    		}
    	}
    }
    
    public class BitMapHandler
    {
    	AssetManager assets;
    	Bitmap bitmap;
    	Context context;
    	
    	public BitMapHandler( Context context, AssetManager assets, Bitmap bitmap )
    	{
    		this.assets = assets;
    		this.bitmap = bitmap;
    	}
    	
    	public void createBitMap( String img )
    	{
    		try {
    			assets = context.getAssets();
    			InputStream inputStream = assets.open( img );
    			bitmap = BitmapFactory.decodeStream( inputStream );
    			inputStream.close();
    		} catch (IOException e) {
    			// Spacer commet
    		} finally {
    		}
    	}
    	
    	public Bitmap getBitmap()
    	{
    		return bitmap;
    	}
    	
    	public void clearBitmap()
    	{
    		bitmap.recycle();
    	}
    	
    	public int height()
    	{
    		return bitmap.getHeight();
    	}
    	
    	public int width()
    	{
    		return bitmap.getWidth();
    	}
	}
}
